# 需求分析与规划阶段SOP

## 阶段目标和概述

### 阶段目标
- 全面理解和分析项目需求，确保需求完整性、一致性和可实现性
- 为后续开发阶段提供清晰的需求指导和规划依据
- 识别潜在风险并制定缓解策略
- 建立需求追踪和变更管理机制

### 阶段概述
需求分析与规划阶段是项目生命周期的起点，通过系统化的方法收集、分析和文档化用户需求，形成可执行的需求规格说明。本阶段将使用ROO Code的多种模式进行需求建模、用户故事创建和架构设计，确保需求分析的全面性和规范性。

## 输入条件和前置要求

### 必要输入
1. **项目启动文档**：包含项目背景、目标、范围和约束
2. **利益相关者信息**：关键用户的角色、职责和联系方式
3. **业务目标**：SMART原则制定的具体业务目标
4. **现有系统文档**：如有升级项目，需要现有系统的功能文档和架构说明

### 前置要求
1. **团队组建完成**：产品经理、业务分析师、架构师等关键角色已确定
2. **项目章程已批准**：项目的基本信息、目标和范围已获得认可
3. **利益相关者访谈计划**：已制定访谈计划和问题清单
4. **工具环境准备**：
   - ROO Code环境已配置
   - 文档管理系统就绪
   - 协作工具（如Confluence、Notion等）已设置

## 详细执行步骤

### 步骤1：需求收集与整理
**时长：2-3天**

1. **利益相关者访谈**
   - 识别所有利益相关者（用户、客户、开发团队、运维团队等）
   - 准备访谈提纲，包含开放式和封闭式问题
   - 记录访谈内容，使用录音和笔记双重记录

2. **需求文档收集**
   - 收集现有的需求文档、用户反馈和竞品分析
   - 整理历史项目的需求文档和经验教训
   - 分析行业标准和最佳实践

3. **需求初步整理**
   - 对收集到的需求进行分类（功能需求、非功能需求、业务规则等）
   - 识别需求之间的依赖关系和优先级
   - 标记模糊和有歧义的需求项

### 步骤2：需求分析与建模
**时长：3-5天**

#### 2.1 使用Architect模式进行需求建模

```bash
# 切换到Architect模式
@architect
```

**Architect模式使用指南：**

1. **系统架构分析**
   - 分析系统边界和外部接口
   - 识别核心业务实体和关系
   - 设计系统组件和交互流程

2. **需求建模技术**
   - 使用UML用例图建模用户需求
   - 创建业务流程图（BPMN）
   - 设计数据流图（DFD）
   - 制定实体关系图（ERD）

3. **架构设计原则**
   - 遵循SOLID设计原则
   - 考虑可扩展性、可维护性和安全性
   - 制定技术选型建议

#### 2.2 使用User Story Creator模式创建用户故事

```bash
# 切换到User Story Creator模式
@user-story-creator
```

**User Story Creator模式使用指南：**

1. **用户故事编写**
   - 遵循"作为一个[用户角色]，我想要[功能]，以便于[价值]"的格式
   - 每个用户故事必须是可独立实现的
   - 确保用户故事符合INVEST原则（Independent、Negotiable、Valuable、Estimable、Small、Testable）

2. **验收标准制定**
   - 为每个用户故事定义明确的验收标准
   - 验收标准应该是可验证的（可通过测试验证）
   - 包含正向场景和异常场景

3. **用户故事拆分**
   - 将大型用户故事拆分为更小的可实现单元
   - 确保每个用户故事可以在一个冲刺内完成
   - 识别用户故事之间的依赖关系

### 步骤3：需求验证与确认
**时长：2-3天**

1. **需求评审会议**
   - 组织需求评审会议，邀请所有关键利益相关者
   - 演示需求模型和用户故事
   - 收集反馈并记录修改意见

2. **需求冲突解决**
   - 识别需求之间的冲突和矛盾
   - 组织利益相关者讨论，达成共识
   - 更新需求文档反映最终决定

3. **需求基线建立**
   - 确认最终需求版本
   - 建立需求基线，标记为不可随意修改
   - 制定需求变更流程

### 步骤4：需求文档编写
**时长：3-4天**

1. **需求规格说明书编写**
   - 按照需求文档模板编写完整的需求规格说明
   - 包含功能需求、非功能需求、业务规则等
   - 添加图表、模型和示例说明

2. **需求文档模板使用**

**需求文档模板结构：**
```markdown
# [项目名称]需求规格说明书

## 1. 引言
- 文档目的
- 文档范围
- 术语定义
- 参考文献

## 2. 总体描述
- 产品前景
- 用户特点
- 一般约束
- 假设和依赖

## 3. 功能需求
- 用例图
- 用例描述
- 用户故事清单

## 4. 非功能需求
- 性能需求
- 安全性需求
- 可用性需求
- 可维护性需求

## 5. 数据需求
- 数据模型
- 数据流图
- 数据字典

## 6. 外部接口需求
- 用户界面需求
- 硬件接口
- 软件接口
- 通信接口

## 7. 验收标准
- 验收测试用例
- 验收通过标准
```

### 步骤5：优先级评估与规划
**时长：1-2天**

#### 5.1 优先级评估方法

1. **MoSCoW方法**
   - **Must have**：必需功能，缺少会导致项目失败
   - **Should have**：重要功能，优先级较高
   - **Could have**：有益功能，如有时间可以实现
   - **Won't have**：本次不实现的功能

2. **价值vs复杂度矩阵**
   - 评估每个需求的业务价值
   - 分析实现复杂度
   - 根据价值和复杂度确定优先级

3. **Kano模型**
   - 基本需求：必需满足，否则用户不满意
   - 性能需求：满足越多，用户满意度越高
   - 魅力需求：超出期望的功能

#### 5.2 风险识别和缓解

1. **风险识别**
   - 技术风险：技术难度高、缺乏经验
   - 需求风险：需求不明确、频繁变更
   - 资源风险：人员、预算、时间不足
   - 外部风险：市场变化、竞争对手

2. **风险评估**
   - 评估每个风险的概率和影响
   - 使用风险矩阵确定风险等级
   - 制定风险缓解策略

3. **缓解策略**
   - 技术风险：原型验证、技术预研
   - 需求风险：需求冻结期、变更控制委员会
   - 资源风险：资源缓冲、优先级调整
   - 外部风险：市场监控、竞争分析

## 产出物清单

### 核心产出物
1. **需求规格说明书**（SRS）
   - 完整的需求文档
   - 包含所有功能和非功能需求
   - 质量指标：通过评审，无严重缺陷

2. **用户故事清单**
   - 所有用户故事的详细描述
   - 验收标准和优先级
   - 质量指标：每个故事符合INVEST原则

3. **需求建模文档**
   - UML图表（用例图、类图、序列图）
   - 业务流程图
   - 数据模型
   - 质量指标：图表清晰准确，利益相关者理解一致

4. **需求验证报告**
   - 需求评审会议纪要
   - 利益相关者反馈记录
   - 需求变更记录
   - 质量指标：所有关键反馈已处理

### 支持性产出物
5. **利益相关者访谈记录**
6. **需求收集原始资料**
7. **优先级评估矩阵**
8. **风险登记册**

## 完成标准和质量指标

### 阶段完成标准
- [ ] 需求规格说明书已编写完成并通过评审
- [ ] 所有用户故事已创建并包含验收标准
- [ ] 需求建模文档已完成，关键模型通过验证
- [ ] 需求基线已建立，变更流程已制定
- [ ] 优先级评估完成，项目范围明确
- [ ] 风险识别和缓解策略已制定
- [ ] 所有关键利益相关者已确认需求

### 质量指标
1. **需求完整性**：≥95%的需求有明确的验收标准
2. **需求一致性**：无冲突性需求，需求间依赖关系清晰
3. **需求可追踪性**：每个需求都可追踪到原始来源
4. **需求可测试性**：≥90%的需求可通过测试验证
5. **文档质量**：需求文档通过同行评审，无严重缺陷
6. **利益相关者满意度**：≥80%的关键利益相关者对需求表示满意

## 常见问题及解决方案

### 问题1：需求不明确
**现象**：利益相关者提供模糊或矛盾的需求
**解决方案**：
- 安排进一步的澄清会议
- 使用原型或示例说明需求
- 将模糊需求分解为具体问题
- 提供需求模板引导利益相关者

### 问题2：需求频繁变更
**现象**：项目过程中需求不断变化
**解决方案**：
- 建立正式的需求变更流程
- 实施需求冻结期
- 使用敏捷方法管理变更
- 加强与利益相关者的沟通

### 问题3：利益相关者意见不一致
**现象**：不同利益相关者对同一需求有不同意见
**解决方案**：
- 组织专门的需求协调会议
- 使用决策矩阵评估不同方案
- 引入产品负责人做最终决策
- 记录决策过程和理由

### 问题4：需求文档过大或过小
**现象**：需求文档过于详细或过于简单
**解决方案**：
- 确定合适的文档粒度
- 使用分层文档结构（概要文档+详细文档）
- 采用用户故事补充详细需求文档
- 定期评审和调整文档范围

### 问题5：技术可行性问题
**现象**：提出的需求在技术上难以实现
**解决方案**：
- 及早引入技术专家进行评审
- 评估替代技术方案
- 调整需求以适应技术约束
- 记录技术约束和假设

## 阶段时间估算

### 时间估算模型
- **小型项目（功能点<50）**：8-12天
- **中型项目（功能点50-200）**：15-25天
- **大型项目（功能点>200）**：30-45天

### 详细时间分配
1. **需求收集与整理**：20%（2-3天）
2. **需求分析与建模**：30%（3-5天）
3. **需求验证与确认**：20%（2-3天）
4. **需求文档编写**：20%（3-4天）
5. **优先级评估与规划**：10%（1-2天）

### 影响因素
- **团队经验**：经验丰富团队可节省20-30%时间
- **领域复杂度**：复杂领域需要更多分析时间
- **利益相关者数量**：利益相关者越多，沟通协调时间越长
- **需求成熟度**：已有需求文档可减少收集时间
- **项目紧急度**：紧急项目需要并行处理，时间可能增加

### 建议
- 预留10-15%的缓冲时间应对不可预见情况
- 对于复杂项目，考虑分阶段进行需求分析
- 及早识别和解决关键需求问题，避免延误